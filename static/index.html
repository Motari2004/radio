<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RadioEarn Monitor</title>
    <style>
        body { background: #121212; color: #00ff41; font-family: 'Courier New', monospace; text-align: center; margin: 0; padding: 20px; }
        .monitor-box { 
            position: relative; 
            display: inline-block; 
            border: 3px solid #333; 
            background: #000;
            margin-top: 10px;
        }
        #screen { width: 100%; max-width: 850px; height: auto; display: block; }
        .controls { margin: 20px; }
        button { 
            padding: 12px 25px; cursor: pointer; margin: 5px; background: #1a1a1a; 
            color: #00ff41; border: 1px solid #00ff41; font-weight: bold;
        }
        button:hover { background: #00ff41; color: #000; }
        #status { font-size: 12px; color: #666; margin-top: 10px; }
    </style>
</head>
<body>
    <h2>RADIOEARN REMOTE TERMINAL</h2>
    
    <div class="controls">
        <button onclick="cmd('play')">FORCE PLAY</button>
        <button onclick="cmd('stop')">FORCE STOP</button>
    </div>

    <div class="monitor-box">
        <img id="screen" src="/screenshot" alt="Waiting for feed...">
    </div>

    <div id="status">Syncing with remote browser...</div>

    <script>
        const screen = document.getElementById('screen');
        const status = document.getElementById('status');

        function updateFrame() {
            // Create a temporary image in memory
            const buffer = new Image();
            const url = "/screenshot?cache=" + Date.now();
            buffer.src = url;

            // Only swap the image once the download is actually finished
            buffer.onload = () => {
                screen.src = url;
                status.innerText = "Feed Updated: " + new Date().toLocaleTimeString();
            };
        }

        function cmd(action) {
            status.innerText = "Sending " + action + "...";
            fetch('/' + action, {method: 'POST'})
                .then(r => r.json())
                .then(d => {
                    status.innerText = "Action " + action + ": " + d.status;
                    setTimeout(updateFrame, 1000); // Quick refresh after command
                });
        }

        // Refresh every 3 seconds for a smooth experience
        setInterval(updateFrame, 3000);
    </script>
</body>
</html>